<?xml version="1.0" encoding="utf-8"?><!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_1.dtd'><nta><declaration>//global
bool resistenicia=false;
bool bomba=false;

const int T_ERROR=20;

//brassagem
bool ingredientes=false;
bool misturou=false;

//canais brassagem
chan add_ingrid;
broadcast chan bem_misturado;
broadcast chan end_control;
chan iodoOK;

//canais recirculacao
broadcast chan UserSedimento,sedimentoOK,PanelaCheia;

//canais lavagem
broadcast chan Lavagem_Bomba;

//canais fervura
broadcast chan adicionado15g,addRestante;

//canais sensor
chan sensorON,sensorOFF,tempMAX,tempMIN;

//FIM PROCESSOS
broadcast chan FIMbrassagem;
broadcast chan FIMrecirculacao;
broadcast chan FIMlavagem;
broadcast chan FIMfervura;

//reiniciar sistema
urgent broadcast chan Reiniciar;

//error states


//TIRAR O SENSOR
//
broadcast chan RED_ALERT1;
broadcast chan RED_ALERT2;
broadcast chan RED_ALERT3;
broadcast chan YELLOW_ALERT;
broadcast chan GREEN_ALERT;

void reset(){
    resistenicia:=false;
    bomba:=false;
    ingredientes:=false;
    misturou:=false;
}


</declaration><template><name x="0" y="0">Brassagem</name><declaration>// Place local declarations here.
clock time;</declaration><location id="id0" x="-4539" y="-501" color="#00ffff"><name x="-4571" y="-533">Fim</name></location><location id="id1" x="-4105" y="-501"><name x="-4122" y="-484">T75G</name><label kind="invariant" x="-4156" y="-467">time&lt;=T_ERROR</label></location><location id="id2" x="-4335" y="-501"></location><location id="id3" x="-3910" y="-501"><name x="-3935" y="-493">Iodo_OK</name></location><location id="id4" x="-3808" y="-501" color="#ffff00"><name x="-3792" y="-517">aguarda_iodo</name></location><location id="id5" x="-3808" y="-756"><name x="-3792" y="-772">wait</name><label kind="invariant" x="-3792" y="-756">time&lt;=60</label></location><location id="id6" x="-4540" y="-756"><name x="-4572" y="-788">Inicio</name></location><location id="id7" x="-3952" y="-756" color="#ffff00"><name x="-3978" y="-790">Misturar</name></location><location id="id8" x="-4107" y="-755" color="#ffff00"><name x="-4131" y="-790">add_ing</name></location><location id="id9" x="-4318" y="-757"><name x="-4335" y="-807">T70G</name><label kind="invariant" x="-4369" y="-790">time&lt;=T_ERROR</label></location><location id="id10" x="-4105" y="-637" color="#ff0000"></location><init ref="id6"/><transition><source ref="id9"/><target ref="id10"/><label kind="guard" x="-4301" y="-688">time&gt;=T_ERROR</label></transition><transition><source ref="id1"/><target ref="id10"/><label kind="guard" x="-4088" y="-578">time&gt;=T_ERROR</label></transition><transition><source ref="id0"/><target ref="id6"/><label kind="synchronisation" x="-4666" y="-637">Reiniciar?</label><nail x="-4598" y="-501"/><nail x="-4596" y="-756"/></transition><transition><source ref="id2"/><target ref="id0"/><label kind="synchronisation" x="-4496" y="-501">FIMbrassagem!</label></transition><transition><source ref="id1"/><target ref="id2"/><label kind="guard" x="-4275" y="-501">time&lt;T_ERROR</label><label kind="synchronisation" x="-4267" y="-484">tempMAX?</label><label kind="assignment" x="-4284" y="-467">resistenicia:=false</label></transition><transition><source ref="id3"/><target ref="id1"/><label kind="synchronisation" x="-4029" y="-501">sensorON!</label><label kind="assignment" x="-4046" y="-484">resistenicia:=true,
time:=0</label></transition><transition><source ref="id4"/><target ref="id3"/><label kind="synchronisation" x="-3876" y="-501">iodoOK?</label></transition><transition><source ref="id5"/><target ref="id4"/><label kind="guard" x="-3799" y="-638">time&gt;=60</label><label kind="synchronisation" x="-3799" y="-654">end_control!</label></transition><transition><source ref="id7"/><target ref="id5"/><label kind="synchronisation" x="-3920" y="-804">bem_misturado?</label><label kind="assignment" x="-3918" y="-791">resistenicia=false,
time:=0</label></transition><transition><source ref="id6"/><target ref="id9"/><label kind="synchronisation" x="-4513" y="-807">sensorON!</label><label kind="assignment" x="-4513" y="-790">resistenicia:=true,
time:=0</label></transition><transition><source ref="id8"/><target ref="id7"/><label kind="synchronisation" x="-4064" y="-788">add_ingrid?</label><label kind="assignment" x="-4064" y="-772">bomba=true</label></transition><transition><source ref="id9"/><target ref="id8"/><label kind="guard" x="-4241" y="-790">time&lt;T_ERROR</label><label kind="synchronisation" x="-4232" y="-807">tempMAX?</label><label kind="assignment" x="-4232" y="-773">bomba=false</label></transition></template><template><name>Recirculacao</name><declaration>clock time;</declaration><location id="id11" x="-520" y="-264" color="#ff0000"><name x="-544" y="-248">ERROR</name></location><location id="id12" x="-536" y="-408" color="#ffff00"><name x="-608" y="-448">sedimento_OK</name></location><location id="id13" x="-714" y="-408"><name x="-782" y="-399">inicio_sedimento</name></location><location id="id14" x="-857" y="-408"><name x="-875" y="-442">Inicio</name></location><location id="id15" x="-178" y="-408" color="#00ffff"><name x="-161" y="-425">Fim_lavagem</name></location><location id="id16" x="-339" y="-408" color="#ffff00"></location><init ref="id14"/><transition><source ref="id16"/><target ref="id11"/></transition><transition><source ref="id12"/><target ref="id11"/></transition><transition><source ref="id13"/><target ref="id11"/></transition><transition><source ref="id12"/><target ref="id16"/><label kind="guard" x="-501" y="-433">time&lt;=T_ERROR</label><label kind="synchronisation" x="-501" y="-408">FIMrecirculacao!</label><label kind="assignment" x="-476" y="-391">time:=0</label><nail x="-458" y="-408"/></transition><transition><source ref="id15"/><target ref="id14"/><label kind="synchronisation" x="-510" y="-184">Reiniciar?</label><nail x="-176" y="-184"/><nail x="-856" y="-184"/></transition><transition><source ref="id16"/><target ref="id15"/><label kind="guard" x="-306" y="-408">time&lt;=T_ERROR</label><label kind="synchronisation" x="-289" y="-425">FIMlavagem!</label></transition><transition><source ref="id13"/><target ref="id12"/><label kind="synchronisation" x="-672" y="-424">sedimentoOK?</label></transition><transition><source ref="id14"/><target ref="id13"/><label kind="synchronisation" x="-833" y="-433">FIMbrassagem?</label></transition></template><template><name>Fervura</name><declaration>clock time;
clock global_time;</declaration><location id="id17" x="-360" y="-152" color="#ff0000"></location><location id="id18" x="32" y="-312" color="#00ffff"><name x="48" y="-320">Fim</name></location><location id="id19" x="-112" y="-312"><name x="-128" y="-360">wait5</name><label kind="invariant" x="-128" y="-344">time&lt;=5</label></location><location id="id20" x="-288" y="-314" color="#ffff00"><name x="-320" y="-346">add_resto</name></location><location id="id21" x="-415" y="-314"><name x="-432" y="-344">wait55</name><label kind="invariant" x="-384" y="-312">time&lt;=55</label></location><location id="id22" x="-603" y="-314" color="#ffff00"><name x="-635" y="-346">adicione15g</name></location><location id="id23" x="-744" y="-312"><name x="-754" y="-342">Inicio</name></location><init ref="id23"/><transition><source ref="id19"/><target ref="id17"/><nail x="-344" y="-152"/></transition><transition><source ref="id20"/><target ref="id17"/></transition><transition><source ref="id21"/><target ref="id17"/></transition><transition><source ref="id22"/><target ref="id17"/></transition><transition><source ref="id18"/><target ref="id23"/><label kind="synchronisation" x="-376" y="-32">Reiniciar?</label><nail x="32" y="-40"/><nail x="-744" y="-40"/></transition><transition><source ref="id19"/><target ref="id18"/><label kind="guard" x="-64" y="-352">time&gt;=5</label><label kind="synchronisation" x="-72" y="-336">FIMfervura!</label><label kind="assignment" x="-93" y="-314">resistenicia=false</label></transition><transition><source ref="id20"/><target ref="id19"/><label kind="guard" x="-254" y="-289">time&lt;=T_ERROR</label><label kind="synchronisation" x="-240" y="-336">addRestante!</label><label kind="assignment" x="-233" y="-311">time:=0</label></transition><transition><source ref="id21"/><target ref="id20"/><label kind="guard" x="-448" y="-368">time&gt;=55</label><label kind="assignment" x="-368" y="-296">time:=0</label></transition><transition><source ref="id22"/><target ref="id21"/><label kind="synchronisation" x="-552" y="-336">adicionado15g!</label><label kind="assignment" x="-535" y="-314">time:=0,
global_time:=0</label></transition><transition><source ref="id23"/><target ref="id22"/><label kind="synchronisation" x="-720" y="-336">FIMlavagem?</label><label kind="assignment" x="-722" y="-314">resistenicia=true,
time:=0</label></transition></template><template><name>Sensor</name><location id="id24" x="-1808" y="-336"><name x="-1832" y="-320">Esfriando</name><committed/></location><location id="id25" x="-1808" y="-456"><name x="-1848" y="-488">Aquecendo</name><committed/></location><location id="id26" x="-1696" y="-400"><name x="-1680" y="-408">standby</name></location><location id="id27" x="-1920" y="-400"><name x="-1976" y="-408">Ligado</name></location><init ref="id26"/><transition><source ref="id24"/><target ref="id26"/><label kind="synchronisation" x="-1784" y="-352">tempMIN!</label></transition><transition><source ref="id27"/><target ref="id24"/><label kind="guard" x="-1963" y="-365">resistenicia==false</label></transition><transition><source ref="id25"/><target ref="id26"/><label kind="synchronisation" x="-1776" y="-464">tempMAX!</label></transition><transition><source ref="id27"/><target ref="id25"/><label kind="guard" x="-1963" y="-450">resistenicia==true</label></transition><transition><source ref="id27"/><target ref="id26"/><label kind="synchronisation" x="-1840" y="-288">Reiniciar?</label><nail x="-1920" y="-288"/><nail x="-1696" y="-288"/></transition><transition><source ref="id27"/><target ref="id26"/><label kind="synchronisation" x="-1840" y="-520">sensorOFF?</label><nail x="-1920" y="-504"/><nail x="-1696" y="-504"/></transition><transition><source ref="id26"/><target ref="id27"/><label kind="synchronisation" x="-1840" y="-416">sensorON?</label></transition></template><template><name>User</name><declaration>clock time;
int iodo_test=0;</declaration><location id="id28" x="-1104" y="-144" color="#00ffff"><name x="-1088" y="-160">Fim</name></location><location id="id29" x="-1424" y="-144" color="#ffff00"></location><location id="id30" x="-1616" y="-144" color="#ffff00"><name x="-1672" y="-136">add_resto</name></location><location id="id31" x="-1408" y="-240" color="#ffff00"><name x="-1392" y="-256">panela_cheia</name></location><location id="id32" x="-1616" y="-240" color="#ffff00"><name x="-1640" y="-224">transfere</name></location><location id="id33" x="-1408" y="-368" color="#ffff00"><name x="-1392" y="-376">SedimentoOK</name></location><location id="id34" x="-1616" y="-368" color="#ffff00"><name x="-1656" y="-360">Sedimento</name></location><location id="id35" x="-1072" y="-512" color="#ffff00"><name x="-1120" y="-528">testa</name></location><location id="id36" x="-976" y="-512" color="#ffff00"><name x="-960" y="-520">IodoOk</name></location><location id="id37" x="-1184" y="-512"><name x="-1216" y="-560">espera</name><label kind="invariant" x="-1216" y="-496">time&lt;=15</label></location><location id="id38" x="-1344" y="-512"></location><location id="id39" x="-1520" y="-512" color="#ffff00"><name x="-1552" y="-552">misturar</name></location><location id="id40" x="-1704" y="-512" color="#ffff00"><name x="-1720" y="-560">Inicio</name></location><location id="id41" x="-1011" y="-586" color="#ff0000"></location><init ref="id40"/><transition><source ref="id33"/><target ref="id32"/><label kind="synchronisation" x="-1402" y="-323">FIMrecirculacao?</label><nail x="-1411" y="-297"/><nail x="-1615" y="-297"/></transition><transition><source ref="id35"/><target ref="id41"/><label kind="guard" x="-1020" y="-569">iodo_test&gt;=4</label></transition><transition><source ref="id28"/><target ref="id40"/><label kind="synchronisation" x="-1792" y="-536">Reiniciar?</label><nail x="-1104" y="-104"/><nail x="-1824" y="-104"/><nail x="-1824" y="-512"/></transition><transition><source ref="id29"/><target ref="id28"/><label kind="synchronisation" x="-1312" y="-168">FIMfervura?</label></transition><transition><source ref="id30"/><target ref="id29"/><label kind="synchronisation" x="-1552" y="-168">addRestante?</label></transition><transition><source ref="id31"/><target ref="id30"/><label kind="synchronisation" x="-1400" y="-216">adicionado15g?</label><nail x="-1408" y="-192"/><nail x="-1616" y="-192"/></transition><transition><source ref="id32"/><target ref="id31"/><label kind="synchronisation" x="-1544" y="-264">FIMlavagem?</label></transition><transition><source ref="id36"/><target ref="id34"/><label kind="synchronisation" x="-960" y="-464">FIMbrassagem?</label><nail x="-976" y="-416"/><nail x="-1616" y="-416"/></transition><transition><source ref="id34"/><target ref="id33"/><label kind="synchronisation" x="-1568" y="-392">sedimentoOK!</label></transition><transition><source ref="id35"/><target ref="id37"/><label kind="guard" x="-1071" y="-476">iodo_test&lt;4</label><label kind="assignment" x="-1164" y="-467">time:=0</label><nail x="-1074" y="-442"/></transition><transition><source ref="id37"/><target ref="id35"/><label kind="guard" x="-1120" y="-608">time&gt;=15</label><label kind="assignment" x="-1181" y="-578">iodo_test++</label><nail x="-1072" y="-592"/><nail x="-1072" y="-528"/></transition><transition><source ref="id35"/><target ref="id36"/><label kind="guard" x="-1054" y="-510">iodo_test&lt;4</label><label kind="synchronisation" x="-1037" y="-552">iodoOK!</label></transition><transition><source ref="id38"/><target ref="id37"/><label kind="synchronisation" x="-1312" y="-544">end_control?</label><label kind="assignment" x="-1296" y="-512">time:=0</label></transition><transition><source ref="id39"/><target ref="id38"/><label kind="synchronisation" x="-1472" y="-544">bem_misturado!</label><label kind="assignment" x="-1472" y="-512">misturou=true</label></transition><transition><source ref="id40"/><target ref="id39"/><label kind="synchronisation" x="-1656" y="-544">add_ingrid!</label><label kind="assignment" x="-1672" y="-512">ingredientes=true</label></transition></template><template><name>Controlador</name><location id="id42" x="-464" y="-64" color="#00ffff"><name x="-474" y="-94">Fim</name></location><location id="id43" x="-768" y="0"><committed/></location><location id="id44" x="-768" y="-128"><committed/></location><location id="id45" x="-928" y="-64"><committed/></location><location id="id46" x="-592" y="-64"><committed/></location><location id="id47" x="-768" y="-64"></location><location id="id48" x="-1072" y="-64"><name x="-1112" y="-88">Inicio</name></location><init ref="id48"/><transition><source ref="id42"/><target ref="id48"/><label kind="synchronisation" x="-768" y="80">Reiniciar?</label><nail x="-464" y="80"/><nail x="-1072" y="80"/></transition><transition><source ref="id46"/><target ref="id42"/><label kind="synchronisation" x="-576" y="-96">sensorOFF!</label></transition><transition><source ref="id43"/><target ref="id47"/><label kind="synchronisation" x="-752" y="0">sensorON!</label><label kind="assignment" x="-752" y="16">resistenicia:=true,
bomba:=true</label><nail x="-720" y="0"/></transition><transition><source ref="id47"/><target ref="id43"/><label kind="synchronisation" x="-864" y="16">tempMIN?</label><nail x="-832" y="0"/></transition><transition><source ref="id44"/><target ref="id47"/><label kind="synchronisation" x="-752" y="-192">sensorON!</label><label kind="assignment" x="-752" y="-176">resistenicia:=false,
bomba:=false</label><nail x="-704" y="-128"/></transition><transition><source ref="id47"/><target ref="id44"/><label kind="synchronisation" x="-864" y="-160">tempMAX?</label><nail x="-832" y="-128"/></transition><transition><source ref="id45"/><target ref="id47"/><label kind="synchronisation" x="-896" y="-96">sensorON!</label></transition><transition><source ref="id48"/><target ref="id45"/><label kind="synchronisation" x="-1056" y="-96">bem_misturado?</label></transition><transition><source ref="id47"/><target ref="id46"/><label kind="synchronisation" x="-714" y="-85">end_control?</label><label kind="assignment" x="-731" y="-68">resistenicia:=false,
bomba:=false</label></transition></template><template><name>Geral</name><location id="id49" x="357" y="-153"><name x="357" y="-185">Fim</name></location><location id="id50" x="229" y="-153"><name x="205" y="-201">Fervura</name></location><location id="id51" x="80" y="-152"><name x="32" y="-200">Recirculacao</name></location><location id="id52" x="-72" y="-152"><name x="-112" y="-200">Brassagem</name></location><init ref="id52"/><transition><source ref="id51"/><target ref="id50"/><label kind="synchronisation" x="98" y="-169">FIMlavagem?</label></transition><transition><source ref="id49"/><target ref="id52"/><label kind="synchronisation" x="85" y="-102">Reiniciar!</label><label kind="assignment" x="85" y="-83">reset()</label><nail x="357" y="-105"/><nail x="-72" y="-104"/></transition><transition><source ref="id50"/><target ref="id49"/><label kind="synchronisation" x="253" y="-178">FIMfervura?</label></transition><transition><source ref="id52"/><target ref="id51"/><label kind="synchronisation" x="-48" y="-176">FIMbrassagem?</label></transition></template><system>// List one or more processes to be composed into a system.
system Sensor,Controlador,Brassagem,Recirculacao,Fervura,User,Geral;</system></nta>